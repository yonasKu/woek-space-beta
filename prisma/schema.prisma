generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User model (managed by better-auth)
model User {
  id            String   @id @default(cuid())
  email         String   @unique
  emailVerified Boolean  @default(false)
  name          String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  accounts              Account[]
  sessions              Session[]
  ownedOrganizations    Organization[]       @relation("OrganizationOwner")
  organizationMembers   OrganizationMember[]
  sentInvitations       Invitation[]

  @@map("users")
}

// Account model (for better-auth)
model Account {
  id                String   @id @default(cuid())
  userId            String
  accountId         String
  providerId        String
  accessToken       String?
  refreshToken      String?
  idToken           String?
  expiresAt         DateTime?
  password          String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([providerId, accountId])
  @@index([userId])
  @@map("accounts")
}

// Session model (for better-auth)
model Session {
  id        String   @id @default(cuid())
  userId    String
  expiresAt DateTime
  token     String   @unique
  ipAddress String?
  userAgent String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("sessions")
}

// Organization model
model Organization {
  id        String   @id @default(cuid())
  name      String
  slug      String?  @unique
  ownerId   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  owner       User                   @relation("OrganizationOwner", fields: [ownerId], references: [id], onDelete: Cascade)
  members     OrganizationMember[]
  outlines    Outline[]
  invitations Invitation[]

  @@index([ownerId])
  @@map("organizations")
}

// Organization member model
model OrganizationMember {
  id             String   @id @default(cuid())
  organizationId String
  userId         String
  role           Role
  joinedAt       DateTime @default(now())

  organization Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  user         User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([organizationId, userId])
  @@index([organizationId])
  @@index([userId])
  @@map("organization_members")
}

// Outline model
model Outline {
  id             String      @id @default(cuid())
  organizationId String
  header         String
  sectionType    SectionType
  status         Status
  target         Int
  limit          Int
  reviewer       Reviewer
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt

  organization Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId])
  @@map("outlines")
}

// Invitation model
model Invitation {
  id             String    @id @default(cuid())
  organizationId String
  email          String
  role           Role      @default(Member)
  invitedBy      String
  token          String    @unique
  expiresAt      DateTime
  acceptedAt     DateTime?
  createdAt      DateTime  @default(now())

  organization Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  inviter      User         @relation(fields: [invitedBy], references: [id])

  @@index([token])
  @@index([organizationId])
  @@map("invitations")
}

// Enums
enum Role {
  Owner
  Member
}

enum SectionType {
  TableOfContents
  ExecutiveSummary
  TechnicalApproach
  Design
  Capabilities
  FocusDocument
  Narrative
}

enum Status {
  Pending
  InProgress
  Completed
}

enum Reviewer {
  Assim
  Bini
  Mami
}
